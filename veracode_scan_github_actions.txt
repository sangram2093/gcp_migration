jobs:
  veracode-pipeline-scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build artifact
        run: mvn package -DskipTests

      - name: Download Veracode Pipeline Scan
        run: |
          curl -sSLO https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip
          unzip -o pipeline-scan-LATEST.zip

      - name: Run Veracode Pipeline Scan
        run: |
          java -jar pipeline-scan.jar \
            --veracode_api_id ${{ secrets.VERACODE_API_ID }} \
            --veracode_api_key ${{ secrets.VERACODE_API_KEY }} \
            --file target/myapp.jar \
            --jo true \
            --json_output results.json

      - name: Check Veracode results
        run: |
          echo "Parsing results.json..."
          critical_count=$(jq '[.findings[] | select(.issue_type.severity == "Very High" or .issue_type.severity == "High")] | length' results.json)
          echo "High/Critical issues found: $critical_count"
          if [ "$critical_count" -gt 0 ]; then
            echo "❌ Build failed due to High/Critical issues"
            exit 1
          else
            echo "✅ No High/Critical issues found"
          fi


What the Dataproc Sub-Agent does (at a glance)

Collects signals

Cloud Monitoring (cluster/YARN/HDFS/job metrics) 
Google Cloud
+1

Cloud Logging (driver + YARN container logs) 
Google Cloud
+1

Job metadata via Dataproc Jobs API (state, timings, UUIDs, appIds) 
Google Cloud
+2
Google Cloud
+2

Spark event logs (JSON) from Spark History Server / event log dir for stage/task metrics 
Apache Spark
+2
Apache Spark
+2

Builds a performance memory

Daily facts in BigQuery (job runs, stage stats, resource usage).

Baselines (p50/p95) per job/app over trailing N days.

Detects anomalies & pinpoints causes

Idle or unhealthy clusters; over/under-utilization.

Jobs exceeding baseline (e.g., “avg 10 min; today at 28 min”).

Stage(s) driving delay (e.g., “Stage 4 takes 18/28 min, heavy shuffle & spill”).

Acts (guard-railed)

Alert owners with evidence + recommended fixes.

Open tickets; (optional) autoscale/stop non-prod clusters with graceful decommission. 
Google Cloud
+2
Google Cloud
+2
